#!/usr/bin/env python3
"""
Russian Loto Number Announcer
Announces random loto numbers (1-90) with traditional Russian phrases
Uses edge-tts for speech synthesis with Russian voice
"""

import asyncio
import random
import tempfile
import os
from pathlib import Path

import edge_tts
import pygame

# Russian voice - Dmitry sounds natural and friendly
VOICE = "ru-RU-DmitryNeural"

# Traditional Russian loto number phrases (like Maxim Galkin style - playful and theatrical)
LOTO_PHRASES = {
    1: "–ö–æ–ª, –µ–¥–∏–Ω–∏—Ü–∞!",
    2: "–õ–µ–±–µ–¥—å, –¥–≤–æ–π–∫–∞!",
    3: "–¢—Ä–æ–π–∫–∞, –Ω–∞ —Ç—Ä–æ–∏—Ö!",
    4: "–°—Ç—É–ª, —á–µ—Ç—ã—Ä–µ –Ω–æ–∂–∫–∏!",
    5: "–ü—è—Ç—ë—Ä–∫–∞ –æ—Ç–ª–∏—á–Ω–∏–∫!",
    6: "–®–µ—Å—Ç—ë—Ä–∫–∞!",
    7: "–¢–æ–ø–æ—Ä–∏–∫, —Å–µ–º—ë—Ä–∫–∞!",
    8: "–í–æ—Å—å–º—ë—Ä–∫–∞, –º–∞—Ç—Ä—ë—à–∫–∞!",
    9: "–î–µ–≤—è—Ç–∫–∞!",
    10: "–ë—ã—á–∏–π –≥–ª–∞–∑, –¥–µ—Å—è—Ç–∫–∞!",
    11: "–ë–∞—Ä–∞–±–∞–Ω–Ω—ã–µ –ø–∞–ª–æ—á–∫–∏, –æ–¥–∏–Ω–Ω–∞–¥—Ü–∞—Ç—å!",
    12: "–î—é–∂–∏–Ω–∞, –¥–≤–µ–Ω–∞–¥—Ü–∞—Ç—å!",
    13: "–ß—ë—Ä—Ç–æ–≤–∞ –¥—é–∂–∏–Ω–∞, —Ç—Ä–∏–Ω–∞–¥—Ü–∞—Ç—å!",
    14: "–ß–µ—Ç—ã—Ä–Ω–∞–¥—Ü–∞—Ç—å!",
    15: "–ü—è—Ç–Ω–∞–¥—Ü–∞—Ç—å!",
    16: "–®–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç—å!",
    17: "–°–µ–º–Ω–∞–¥—Ü–∞—Ç—å!",
    18: "–í–æ—Å–µ–º–Ω–∞–¥—Ü–∞—Ç—å, –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑!",
    19: "–î–µ–≤—è—Ç–Ω–∞–¥—Ü–∞—Ç—å!",
    20: "–õ–µ–±–µ–¥–∏–Ω–æ–µ –æ–∑–µ—Ä–æ, –¥–≤–∞–¥—Ü–∞—Ç—å!",
    21: "–û—á–∫–æ, –¥–≤–∞–¥—Ü–∞—Ç—å –æ–¥–∏–Ω!",
    22: "–£—Ç—è—Ç–∞, –¥–≤–∞–¥—Ü–∞—Ç—å –¥–≤–∞!",
    23: "–î–≤–∞–¥—Ü–∞—Ç—å —Ç—Ä–∏!",
    24: "–î–≤–∞–¥—Ü–∞—Ç—å —á–µ—Ç—ã—Ä–µ!",
    25: "–û–ø—è—Ç—å –¥–≤–∞–¥—Ü–∞—Ç—å –ø—è—Ç—å!",
    26: "–î–≤–∞–¥—Ü–∞—Ç—å —à–µ—Å—Ç—å!",
    27: "–î–≤–∞–¥—Ü–∞—Ç—å —Å–µ–º—å!",
    28: "–î–≤–∞–¥—Ü–∞—Ç—å –≤–æ—Å–µ–º—å!",
    29: "–î–≤–∞–¥—Ü–∞—Ç—å –¥–µ–≤—è—Ç—å!",
    30: "–¢—Ä–∏–¥—Ü–∞—Ç—å!",
    31: "–¢—Ä–∏–¥—Ü–∞—Ç—å –æ–¥–∏–Ω!",
    32: "–¢—Ä–∏–¥—Ü–∞—Ç—å –¥–≤–∞!",
    33: "–ö—É–¥—Ä–∏, —Ç—Ä–∏–¥—Ü–∞—Ç—å —Ç—Ä–∏!",
    34: "–¢—Ä–∏–¥—Ü–∞—Ç—å —á–µ—Ç—ã—Ä–µ!",
    35: "–¢—Ä–∏–¥—Ü–∞—Ç—å –ø—è—Ç—å!",
    36: "–¢—Ä–∏–¥—Ü–∞—Ç—å —à–µ—Å—Ç—å, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞!",
    37: "–¢—Ä–∏–¥—Ü–∞—Ç—å —Å–µ–º—å!",
    38: "–¢—Ä–∏–¥—Ü–∞—Ç—å –≤–æ—Å–µ–º—å, –ø–µ—Ç–ª–∏—á–∫–∏!",
    39: "–¢—Ä–∏–¥—Ü–∞—Ç—å –¥–µ–≤—è—Ç—å!",
    40: "–°–æ—Ä–æ–∫, —Å–æ—Ä–æ–∫–æ–≤–Ω–∏–∫!",
    41: "–ï–º –æ–¥–∏–Ω, —Å–æ—Ä–æ–∫ –æ–¥–∏–Ω!",
    42: "–°–æ—Ä–æ–∫ –¥–≤–∞!",
    43: "–°–æ—Ä–æ–∫ —Ç—Ä–∏!",
    44: "–°—Ç—É–ª—å—á–∏–∫–∏, —Å–æ—Ä–æ–∫ —á–µ—Ç—ã—Ä–µ!",
    45: "–ë–∞–±–∞ —è–≥–æ–¥–∫–∞ –æ–ø—è—Ç—å, —Å–æ—Ä–æ–∫ –ø—è—Ç—å!",
    46: "–°–æ—Ä–æ–∫ —à–µ—Å—Ç—å!",
    47: "–°–æ—Ä–æ–∫ —Å–µ–º—å, –±–∞–±–∞ —è–≥–æ–¥–∫–∞ —Å–æ–≤—Å–µ–º!",
    48: "–°–æ—Ä–æ–∫ –≤–æ—Å–µ–º—å, –ø–æ–ª–æ–≤–∏–Ω–∫—É –ø—Ä–æ—Å–∏–º!",
    49: "–°–æ—Ä–æ–∫ –¥–µ–≤—è—Ç—å!",
    50: "–ü–æ–ª—Ç–∏–Ω–Ω–∏–∫, –ø—è—Ç—å–¥–µ—Å—è—Ç!",
    51: "–ü—è—Ç—å–¥–µ—Å—è—Ç –æ–¥–∏–Ω!",
    52: "–ü—è—Ç—å–¥–µ—Å—è—Ç –¥–≤–∞!",
    53: "–ü—è—Ç—å–¥–µ—Å—è—Ç —Ç—Ä–∏!",
    54: "–ü—è—Ç—å–¥–µ—Å—è—Ç —á–µ—Ç—ã—Ä–µ!",
    55: "–ü–µ—Ä—á–∞—Ç–∫–∏, –ø—è—Ç—å–¥–µ—Å—è—Ç –ø—è—Ç—å!",
    56: "–ü—è—Ç—å–¥–µ—Å—è—Ç —à–µ—Å—Ç—å!",
    57: "–ü—è—Ç—å–¥–µ—Å—è—Ç —Å–µ–º—å!",
    58: "–ü—è—Ç—å–¥–µ—Å—è—Ç –≤–æ—Å–µ–º—å!",
    59: "–ü—è—Ç—å–¥–µ—Å—è—Ç –¥–µ–≤—è—Ç—å!",
    60: "–ü–µ–Ω—Å–∏–æ–Ω–µ—Ä, —à–µ—Å—Ç—å–¥–µ—Å—è—Ç!",
    61: "–®–µ—Å—Ç—å–¥–µ—Å—è—Ç –æ–¥–∏–Ω!",
    62: "–®–µ—Å—Ç—å–¥–µ—Å—è—Ç –¥–≤–∞!",
    63: "–®–µ—Å—Ç—å–¥–µ—Å—è—Ç —Ç—Ä–∏!",
    64: "–®–µ—Å—Ç—å–¥–µ—Å—è—Ç —á–µ—Ç—ã—Ä–µ!",
    65: "–®–µ—Å—Ç—å–¥–µ—Å—è—Ç –ø—è—Ç—å, –ø–µ–Ω—Å–∏—è!",
    66: "–í–∞–ª–µ–Ω–∫–∏, —à–µ—Å—Ç—å–¥–µ—Å—è—Ç —à–µ—Å—Ç—å!",
    67: "–®–µ—Å—Ç—å–¥–µ—Å—è—Ç —Å–µ–º—å!",
    68: "–®–µ—Å—Ç—å–¥–µ—Å—è—Ç –≤–æ—Å–µ–º—å!",
    69: "–¢—É–¥–∞-—Å—é–¥–∞, —à–µ—Å—Ç—å–¥–µ—Å—è—Ç –¥–µ–≤—è—Ç—å!",
    70: "–¢–æ–ø–æ—Ä –≤ –ø–Ω–µ, —Å–µ–º—å–¥–µ—Å—è—Ç!",
    71: "–°–µ–º—å–¥–µ—Å—è—Ç –æ–¥–∏–Ω!",
    72: "–°–µ–º—å–¥–µ—Å—è—Ç –¥–≤–∞!",
    73: "–°–µ–º—å–¥–µ—Å—è—Ç —Ç—Ä–∏!",
    74: "–°–µ–º—å–¥–µ—Å—è—Ç —á–µ—Ç—ã—Ä–µ!",
    75: "–°–µ–º—å–¥–µ—Å—è—Ç –ø—è—Ç—å!",
    76: "–°–µ–º—å–¥–µ—Å—è—Ç —à–µ—Å—Ç—å!",
    77: "–¢–æ–ø–æ—Ä–∏–∫–∏, —Å–µ–º—å–¥–µ—Å—è—Ç —Å–µ–º—å!",
    78: "–°–µ–º—å–¥–µ—Å—è—Ç –≤–æ—Å–µ–º—å!",
    79: "–°–µ–º—å–¥–µ—Å—è—Ç –¥–µ–≤—è—Ç—å!",
    80: "–ë–∞–±—É—à–∫–∞, –≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç!",
    81: "–ë–∞–±–∫–∞ —Å –∫–ª—é—à–∫–æ–π, –≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç –æ–¥–∏–Ω!",
    82: "–í–æ—Å–µ–º—å–¥–µ—Å—è—Ç –¥–≤–∞!",
    83: "–í–æ—Å–µ–º—å–¥–µ—Å—è—Ç —Ç—Ä–∏!",
    84: "–í–æ—Å–µ–º—å–¥–µ—Å—è—Ç —á–µ—Ç—ã—Ä–µ!",
    85: "–í–æ—Å–µ–º—å–¥–µ—Å—è—Ç –ø—è—Ç—å!",
    86: "–í–æ—Å–µ–º—å–¥–µ—Å—è—Ç —à–µ—Å—Ç—å!",
    87: "–í–æ—Å–µ–º—å–¥–µ—Å—è—Ç —Å–µ–º—å!",
    88: "–ë–∞–±—É—à–∫–∏, –≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç –≤–æ—Å–µ–º—å!",
    89: "–î–µ–¥—É—à–∫–∏–Ω —Å–æ—Å–µ–¥, –≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç –¥–µ–≤—è—Ç—å!",
    90: "–î–µ–¥—É—à–∫–∞, –¥–µ–≤—è–Ω–æ—Å—Ç–æ!",
}

# Fun intro phrases (Galkin-style theatrical)
INTRO_PHRASES = [
    "–î–∞–º—ã –∏ –≥–æ—Å–ø–æ–¥–∞! –ù–∞—á–∏–Ω–∞–µ–º —Ä—É—Å—Å–∫–æ–µ –ª–æ—Ç–æ!",
    "–í–Ω–∏–º–∞–Ω–∏–µ, –≤–Ω–∏–º–∞–Ω–∏–µ! –õ–æ—Ç–µ—Ä–µ—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è!",
    "–ü—Ä–∏–≥–æ—Ç–æ–≤—å—Ç–µ –≤–∞—à–∏ –∫–∞—Ä—Ç–æ—á–∫–∏! –ü–æ–µ—Ö–∞–ª–∏!",
    "–ö—Ä—É—Ç–∏–º –±–∞—Ä–∞–±–∞–Ω! –î–æ—Å—Ç–∞—ë–º –±–æ—á–æ–Ω–∫–∏!",
]

# Transition phrases between numbers
TRANSITION_PHRASES = [
    "–°–ª–µ–¥—É—é—â–∏–π –Ω–æ–º–µ—Ä...",
    "–ê —Ç–µ–ø–µ—Ä—å...",
    "–î–æ—Å—Ç–∞—ë–º...",
    "–ö—Ä—É—Ç–∏–º –±–∞—Ä–∞–±–∞–Ω...",
    "–ò –≤—ã–ø–∞–¥–∞–µ—Ç...",
    "–ß—Ç–æ —É –Ω–∞—Å —Ç—É—Ç?",
    "–¢–∞–∞–∞–∫...",
    "–°–º–æ—Ç—Ä–∏–º...",
    "–ù—É-–∫–∞, –Ω—É-–∫–∞...",
    "",  # Sometimes just silence
    "",
    "",
]


async def speak(text: str, temp_dir: Path, voice: str = VOICE) -> None:
    """Generate and play speech using edge-tts."""
    audio_file = temp_dir / "speech.mp3"

    communicate = edge_tts.Communicate(text, voice)
    await communicate.save(str(audio_file))

    pygame.mixer.music.load(str(audio_file))
    pygame.mixer.music.play()

    while pygame.mixer.music.get_busy():
        await asyncio.sleep(0.1)


async def run_loto(count: int = 15, delay_min: float = 2.0, delay_max: float = 5.0, voice: str = VOICE) -> None:
    """Run the loto game, announcing random numbers."""
    pygame.mixer.init()

    with tempfile.TemporaryDirectory() as temp_dir:
        temp_path = Path(temp_dir)

        # Welcome message
        intro = random.choice(INTRO_PHRASES)
        print(f"\nüé∞ {intro}\n")
        await speak(intro, temp_path, voice)
        await asyncio.sleep(1.5)

        # Generate unique random numbers
        all_numbers = list(range(1, 91))
        random.shuffle(all_numbers)
        numbers_to_call = all_numbers[:count]

        called = []

        for i, num in enumerate(numbers_to_call, 1):
            # Occasional transition phrase
            if random.random() > 0.4:
                transition = random.choice(TRANSITION_PHRASES)
                if transition:
                    await speak(transition, temp_path, voice)
                    await asyncio.sleep(0.5)

            # Get the phrase for this number
            phrase = LOTO_PHRASES.get(num, f"–ù–æ–º–µ—Ä {num}!")

            print(f"  [{i:2d}/{count}] üé± {num:2d} - {phrase}")
            await speak(phrase, temp_path, voice)

            called.append(num)

            # Random delay between numbers
            if i < count:
                delay = random.uniform(delay_min, delay_max)
                await asyncio.sleep(delay)

        # Closing
        await asyncio.sleep(1)
        closing = "–í—Å–µ –Ω–æ–º–µ—Ä–∞ –Ω–∞–∑–≤–∞–Ω—ã! –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏!"
        print(f"\nüèÜ {closing}")
        await speak(closing, temp_path, voice)

        # Summary
        print(f"\nüìã –í—ã–ø–∞–≤—à–∏–µ –Ω–æ–º–µ—Ä–∞: {', '.join(map(str, sorted(called)))}")

    pygame.mixer.quit()


def main():
    """Main entry point."""
    import argparse

    parser = argparse.ArgumentParser(description="–†—É—Å—Å–∫–æ–µ –õ–æ—Ç–æ - –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —á–∏—Å–µ–ª —Å –æ–∑–≤—É—á–∫–æ–π")
    parser.add_argument("-n", "--count", type=int, default=15,
                        help="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∏—Å–µ–ª –¥–ª—è —Ä–æ–∑—ã–≥—Ä—ã—à–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 15)")
    parser.add_argument("--min-delay", type=float, default=2.0,
                        help="–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —á–∏—Å–ª–∞–º–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 2.0)")
    parser.add_argument("--max-delay", type=float, default=5.0,
                        help="–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —á–∏—Å–ª–∞–º–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5.0)")
    parser.add_argument("--voice", type=str, default=VOICE,
                        help=f"–ì–æ–ª–æ—Å –¥–ª—è –æ–∑–≤—É—á–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: {VOICE})")

    args = parser.parse_args()

    voice = args.voice

    print("=" * 50)
    print("     üé∞ –†–£–°–°–ö–û–ï –õ–û–¢–û üé∞")
    print("=" * 50)
    print(f"  –ì–æ–ª–æ—Å: {voice}")
    print(f"  –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∏—Å–µ–ª: {args.count}")
    print(f"  –ó–∞–¥–µ—Ä–∂–∫–∞: {args.min_delay}-{args.max_delay} —Å–µ–∫")
    print("=" * 50)

    try:
        asyncio.run(run_loto(
            count=args.count,
            delay_min=args.min_delay,
            delay_max=args.max_delay,
            voice=voice
        ))
    except KeyboardInterrupt:
        print("\n\nüëã –ò–≥—Ä–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞. –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!")


if __name__ == "__main__":
    main()
